import json
import tomllib
from typing import Any, Dict, List, Literal

import tomli_w

from project.utils import C, Dir

with Dir.api_keys.open("rb") as f:
    config = tomllib.load(f)
API_KEY = config["systeme-solaire"]
API_URL = "https://api.le-systeme-solaire.net/rest/bodies"
HEADERS = {"Authorization": f"Bearer {API_KEY}"}


class SystemeSolaireBodies:
    def __init__(self) -> None:
        with open(Dir.data / "systeme_solaire.json", "r", encoding="utf-8") as f:
            self.bodies = json.load(f)["bodies"]

    def extract_values(self) -> None:
        bodies_filtered: Dict[str, Dict[str, float | None]] = {}
        for body in self.bodies:
            bodies_filtered[body["englishName"]] = {
                "Radius": extract_radius(body),
                "GM": extract_gm(body),
            }
        with open(Dir.data / "systeme_solaire.toml", "wb") as f:
            tomli_w.dump(bodies_filtered, f)

    def extract_names(self) -> List[str]:
        out: List[str] = []
        for body in self.bodies:
            out.append(body["englishName"])

        return out


def extract_radius(body: Dict[str, Any]) -> float:
    """Return mean radius in meters if available."""
    if body.get("meanRadius"):
        return float(body["meanRadius"])  # km
    return 0.0


def extract_gm(body: Dict[str, Any]) -> float:
    """Return GM in m^3/s^2 if possible."""
    # Some bodies provide mass instead of GM
    mass = body.get("mass", {})
    if (
        mass is not None
        and mass.get("massValue")
        and mass.get("massExponent") is not None
    ):
        mass_kg = float(mass["massValue"] * 10 ** mass["massExponent"])
        return C.G_KM * mass_kg
    return 0.0


SystemeSolaireBodiesLiteral = Literal[
    "Moon"
    "Phobos"
    "Deimos"
    "Io"
    "Europa"
    "Ganymede"
    "Callisto"
    "Amalthea"
    "Himalia"
    "Elara"
    "Pasiphae"
    "Sinope"
    "Lysithea"
    "Carme"
    "Ananke"
    "Leda"
    "Thebe"
    "Adrastea"
    "Metis"
    "Callirrhoe"
    "Themisto"
    "Megaclite"
    "Taygete"
    "Chaldene"
    "Harpalyke"
    "Kalyke"
    "Iocaste"
    "Erinome"
    "Isonoe"
    "Praxidike"
    "Autonoe"
    "Thyone"
    "Hermippe"
    "Aitne"
    "Eurydome"
    "Euanthe"
    "Euporie"
    "Orthosie"
    "Sponde"
    "Kale"
    "Pasithee"
    "Hegemone"
    "Mneme"
    "Aoede"
    "Thelxinoe"
    "Arche"
    "Kallichore"
    "Helike"
    "Carpo"
    "Eukelade"
    "Cyllene"
    "Kore"
    "Herse"
    "S/2003 J 2"
    "Eupheme"
    "S/2003 J 4"
    "Eirene"
    "S/2003 J 9"
    "S/2003 J 10"
    "S/2003 J 12"
    "Philophrosyne"
    "S/2003 J 16"
    "S/2003 J 18"
    "S/2003 J 19"
    "S/2003 J 23"
    "Mimas"
    "Enceladus"
    "Tethys"
    "Dione"
    "Rhea"
    "Titan"
    "Hyperion"
    "Iapetus"
    "Phoebe"
    "Janus"
    "Epimetheus"
    "Helene"
    "Telesto"
    "Calypso"
    "Atlas"
    "Prometheus"
    "Pandora"
    "Pan"
    "Ymir"
    "Paaliaq"
    "Tarvos"
    "Ijiraq"
    "Suttungr"
    "Kiviuq"
    "Mundilfari"
    "Albiorix"
    "Skathi"
    "Erriapus"
    "Siarnaq"
    "Thrymr"
    "Narvi"
    "Methone"
    "Pallene"
    "Polydeuces"
    "Daphnis"
    "Aegir"
    "Bebhionn"
    "Bergelmir"
    "Bestla"
    "Farbauti"
    "Fenrir"
    "Fornjot"
    "Hati"
    "Hyrrokkin"
    "Kari"
    "Loge"
    "Skoll"
    "Surtur"
    "Anthe"
    "Jarnsaxa"
    "Greip"
    "Tarqeq"
    "Aegaeon"
    "S/2004 S 7"
    "S/2004 S 12"
    "S/2004 S 13"
    "S/2004 S 17"
    "S/2006 S 1"
    "S/2006 S 3"
    "S/2007 S 2"
    "S/2007 S 3"
    "S/2009 S 1"
    "Ariel"
    "Umbriel"
    "Titania"
    "Oberon"
    "Miranda"
    "Cordelia"
    "Ophelia"
    "Bianca"
    "Cressida"
    "Desdemona"
    "Juliet"
    "Portia"
    "Rosalind"
    "Belinda"
    "Puck"
    "Caliban"
    "Sycorax"
    "Prospero"
    "Setebos"
    "Stephano"
    "Trinculo"
    "Francisco"
    "Margaret"
    "Ferdinand"
    "Perdita"
    "Mab"
    "Cupid"
    "Triton"
    "Nereid"
    "Naiad"
    "Thalassa"
    "Despina"
    "Galatea"
    "Larissa"
    "Proteus"
    "Halimede"
    "Psamathe"
    "Sao"
    "Laomedeia"
    "Neso"
    "Charon"
    "Nix"
    "Hydra"
    "Namaka"
    "Hiʻiaka"
    "Dysnomia"
    "Dia"
    "S/2004 S 3"
    "S/2004 S 4"
    "S/2004 S 6"
    "S/2010 J 1"
    "S/2010 J 2"
    "1 Ceres"
    "6 Hebe"
    "47171 Lempo"
    "The Little Prince"
    "762 Pulcova"
    "4179 Toutatis"
    "50000 Quaoar"
    "2867 Šteins"
    "136199 Eris"
    "5 Astraea"
    "5145 Pholus"
    "4769 Castalia"
    "Remus"
    "624 Hektor"
    "216 Kleopatra"
    "3753 Cruithne"
    "3 Juno"
    "10 Hygiea"
    "21 Lutetia"
    "253 Mathilde"
    "Uranus"
    "7 Iris"
    "433 Eros"
    "Vanth"
    "90377 Sedna"
    "10199 Chariklo"
    "87 Sylvia"
    "(243) Ida I Dactyl"
    "90482 Orcus"
    "Pluto"
    "5335 Damocles"
    "Romulus"
    "Alexhelios"
    "Cleoselene"
    "8 Flora"
    "2060 Chiron"
    "5261 Eureka"
    "588 Achilles"
    "Weywot"
    "28978 Ixion"
    "Neptune"
    "Shoemaker-Levy 9"
    "9 Metis"
    "136108 Haumea"
    "7066 Nessus"
    "25143 Itokawa"
    "10370 Hylonome"
    "45 Eugenia"
    "(308933) 2006 SQ372"
    "2 Pallas"
    "8405 Asbolus"
    "20000 Varuna"
    "4 Vesta"
    "243 Ida"
    "Comet Hyakutake"
    "951 Gaspra"
    "15760 Albion"
    "136472 Makemake"
    "Halley's Comet"
    "Jupiter"
    "Mars"
    "Mercury"
    "Saturn"
    "Sun"
    "Earth"
    "Venus"
    "Kerberos"
    "S/2011 J 1"
    "S/2011 J 2"
    "Styx"
    "Hippocamp"
    "S/2015 (136472) 1"
    "S/2017 J 1"
    "S/2016 J 1"
    "Valetudo"
    "S/2017 J 2"
    "S/2017 J 3"
    "Pandia"
    "S/2017 J 5"
    "S/2017 J 6"
    "S/2017 J 7"
    "S/2017 J 8"
    "S/2017 J 9"
    "Ersa"
    "Arrokoth"
    "101955 Bennu"
    "Angrboda"
    "S/2004 S 21"
    "Gridr"
    "Skrymir"
    "S/2004 S 24"
    "Gerd"
    "S/2004 S 26"
    "Eggther"
    "S/2004 S 28"
    "S/2004 S 29"
    "Beli"
    "S/2004 S 31"
    "Gunnlod"
    "Thiazzi"
    "S/2004 S 34"
    "Alvaldi"
    "S/2004 S 36"
    "S/2004 S 37"
    "Geirrod"
    "S/2004 S 39"
    "C/2020 F3 (NEOWISE)"
    "S/2004 S 41"
    "S/2003 J 24"
    "S/2004 S 40"
    "S/2004 S 42"
    "S/2004 S 43"
    "S/2004 S 44"
    "S/2004 S 45"
    "S/2004 S 46"
    "S/2004 S 47"
    "S/2004 S 48"
    "S/2004 S 49"
    "S/2004 S 50"
    "S/2004 S 51"
    "S/2004 S 52"
    "S/2004 S 53"
    "S/2005 S 4"
    "S/2005 S 5"
    "S/2006 S 10"
    "S/2006 S 11"
    "S/2006 S 12"
    "S/2006 S 13"
    "S/2006 S 14"
    "S/2006 S 15"
    "S/2006 S 16"
    "S/2006 S 17"
    "S/2006 S 18"
    "S/2006 S 19"
    "S/2006 S 20"
    "S/2007 S 5"
    "S/2007 S 6"
    "S/2007 S 7"
    "S/2007 S 8"
    "S/2007 S 9"
    "S/2019 S 1"
    "S/2019 S 10"
    "S/2019 S 11"
    "S/2019 S 12"
    "S/2019 S 13"
    "S/2019 S 14"
    "S/2019 S 15"
    "S/2019 S 16"
    "S/2019 S 17"
    "S/2019 S 18"
    "S/2019 S 19"
    "S/2019 S 2"
    "S/2019 S 20"
    "S/2019 S 21"
    "S/2019 S 3"
    "S/2019 S 4"
    "S/2019 S 5"
    "S/2019 S 6"
    "S/2019 S 7"
    "S/2019 S 8"
    "S/2019 S 9"
    "S/2020 S 1"
    "S/2020 S 10"
    "S/2020 S 2"
    "S/2020 S 3"
    "S/2020 S 4"
    "S/2020 S 5"
    "S/2020 S 6"
    "S/2020 S 7"
    "S/2020 S 8"
    "S/2020 S 9"
    "S/2006 S 9"
    "S/2011 J 3"
    "S/2016 J 3"
    "S/2016 J 4"
    "S/2018 J 2"
    "S/2018 J 3"
    "S/2018 J 4"
    "S/2021 J 1"
    "S/2021 J 2"
    "S/2021 J 3"
    "S/2021 J 4"
    "S/2021 J 5"
    "S/2021 J 6"
    "S/2022 J 1"
    "S/2022 J 2"
    "S/2022 J 3"
    "S/2023 U 1"
    "S/2017 J 11"
    "S/2005 U 1"
    "S/2021 N 1"
    "S/2002 N 5"
    "S/2017 J 10"
    "(162173) Ryugu"
    "S/2019 S 22"
    "S/2019 S 23"
    "S/2019 S 26"
    "S/2019 S 32"
    "S/2019 S 35"
    "S/2019 S 37"
    "S/2019 S 41"
    "S/2019 S 44"
    "S/2020 S 11"
    "S/2020 S 12"
    "S/2020 S 13"
    "S/2020 S 16"
    "S/2020 S 17"
    "S/2020 S 19"
    "S/2020 S 20"
    "S/2020 S 22"
    "S/2020 S 23"
    "S/2020 S 24"
    "S/2020 S 30"
    "S/2020 S 31"
    "S/2020 S 33"
    "S/2020 S 34"
    "S/2020 S 38"
    "S/2020 S 39"
    "S/2020 S 41"
    "S/2020 S 42"
    "S/2020 S 43"
    "S/2020 S 44"
    "S/2023 S 1"
    "S/2023 S 2"
    "S/2023 S 3"
    "S/2023 S 5"
    "S/2023 S 6"
    "S/2023 S 7"
    "S/2023 S 8"
    "S/2023 S 9"
    "S/2023 S 10"
    "S/2023 S 13"
    "S/2023 S 16"
    "S/2023 S 17"
    "S/2023 S 18"
    "S/2023 S 19"
    "S/2023 S 20"
    "S/2023 S 21"
    "S/2023 S 22"
    "S/2023 S 23"
    "S/2023 S 24"
    "S/2023 S 25"
    "S/2023 S 27"
    "S/2023 S 29"
    "S/2023 S 30"
    "S/2023 S 32"
    "S/2023 S 33"
    "S/2023 S 34"
    "S/2023 S 42"
    "S/2023 S 43"
    "S/2023 S 45"
    "S/2023 S 46"
    "S/2023 S 47"
    "S/2023 S 49"
    "S/2023 S 50"
    "S/2004 S 54"
    "S/2004 S 55"
    "S/2004 S 56"
    "S/2004 S 57"
    "S/2004 S 58"
    "S/2004 S 59"
    "S/2004 S 60"
    "S/2004 S 61"
    "S/2005 S 6"
    "S/2005 S 7"
    "S/2006 S 21"
    "S/2006 S 22"
    "S/2006 S 23"
    "S/2006 S 24"
    "S/2006 S 25"
    "S/2006 S 26"
    "S/2006 S 27"
    "S/2006 S 28"
    "S/2006 S 29"
    "S/2007 S 10"
    "S/2007 S 11"
    "S/2019 S 24"
    "S/2019 S 25"
    "S/2019 S 27"
    "S/2019 S 29"
    "S/2019 S 31"
    "S/2019 S 33"
    "S/2019 S 34"
    "S/2019 S 40"
    "S/2019 S 42"
    "S/2019 S 43"
    "S/2020 S 26"
    "S/2020 S 27"
    "S/2019 S 28"
    "S/2019 S 30"
    "S/2019 S 36"
    "S/2019 S 38"
    "S/2019 S 39"
    "S/2020 S 14"
    "S/2020 S 15"
    "S/2020 S 18"
    "S/2020 S 21"
    "S/2020 S 25"
    "S/2020 S 28"
    "S/2020 S 29"
    "S/2020 S 32"
    "S/2020 S 35"
    "S/2020 S 36"
    "S/2020 S 37"
    "S/2020 S 40"
    "S/2023 S 4"
    "S/2023 S 11"
    "S/2023 S 12"
    "S/2023 S 14"
    "S/2023 S 15"
    "S/2023 S 26"
    "S/2023 S 28"
    "S/2023 S 31"
    "S/2023 S 35"
    "S/2023 S 36"
    "S/2023 S 37"
    "S/2023 S 38"
    "S/2023 S 39"
    "S/2023 S 40"
    "S/2023 S 41"
    "S/2023 S 44"
    "S/2023 S 48"
    "(16) Psyche"
    "Tempel 1"
]


if __name__ == "__main__":
    s = SystemeSolaireBodies()
    n = s.extract_names()

    with open("temp.txt", "w", encoding="utf-8") as f:
        f.writelines([f'"{body}"\n' for body in n])
